<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>COCO PREMIUM V2</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #f1c40f; --dark: #0a0a0a; --gray: #222; }
        body { background: var(--dark); color: white; text-align: center; font-family: sans-serif; user-select: none; margin: 0; padding-bottom: 80px; }
        
        .page { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        #balance { font-size: 50px; font-weight: bold; color: white; text-shadow: 0 0 15px var(--gold); margin: 10px 0; }
        .coin-btn { width: 200px; height: 200px; border-radius: 50%; background: radial-gradient(#5d4037, #000); border: 8px solid var(--gray); margin: 30px auto; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 80px; transition: 0.1s; }
        .coin-btn:active { transform: scale(0.9); border-color: var(--gold); }

        .stat-card { background: #111; padding: 15px; border-radius: 15px; margin: 10px; border: 1px solid #333; }
        .btn-action { background: var(--gold); color: black; border: none; padding: 12px 25px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #0a0a0a; border-top: 1px solid #222; padding: 10px 0; }
        .nav-item { flex: 1; font-size: 11px; color: #555; cursor: pointer; }
        .nav-item.active { color: var(--gold); }

        .floating-text { position: absolute; color: var(--gold); font-weight: bold; animation: moveUp 0.6s forwards; pointer-events: none; }
        @keyframes moveUp { to { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

    <div id="mine" class="page active">
        <div style="font-size: 12px; letter-spacing: 2px;">MINING STATUS</div>
        <div id="balance">0</div>
        <div class="coin-btn" id="tap-btn">ü••</div>
        <div class="stat-card">‚ö° ENERGY: <span id="energy">1000</span> / 1000</div>
    </div>

    <div id="tasks" class="page">
        <h2>EARN MORE</h2>
        <div class="stat-card">
            <p>Join Telegram Channel</p>
            <button class="btn-action" onclick="doTask('tg', 5000)">+ 5,000 ¬¢</button>
        </div>
        <div class="stat-card">
            <p>Follow on Twitter/X</p>
            <button class="btn-action" onclick="doTask('tw', 3000)">+ 3,000 ¬¢</button>
        </div>
    </div>

    <div id="withdraw" class="page">
        <h2>WITHDRAWAL</h2>
        <div class="stat-card">
            <p>Minimum: 1,000,000 ¬¢</p>
            <input type="text" id="wallet-addr" placeholder="Enter Wallet/Phone" style="width:90%; padding:10px; border-radius:5px; border:none; margin-bottom:10px;">
            <button class="btn-action" onclick="requestWithdraw()">SEND REQUEST</button>
        </div>
    </div>

    <div class="nav">
        <div class="nav-item active" onclick="showPage('mine', this)">‚õèÔ∏è MINE</div>
        <div class="nav-item" onclick="showPage('tasks', this)">üìã TASKS</div>
        <div class="nav-item" onclick="showPage('withdraw', this)">üí∞ WITHDRAW</div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDE9SYe-4rS5jMeXStqg9pc_IuBsiySdaU",
            databaseURL: "https://cococoin-mine-c7b27-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "cococoin-mine-c7b27"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;

        let userId = tg.initDataUnsafe?.user?.id || localStorage.getItem('guest_id') || "GUEST_"+Math.floor(Math.random()*999);
        if(!localStorage.getItem('guest_id')) localStorage.setItem('guest_id', userId);

        let balance = 0;
        let energy = 1000;
        let isLoaded = false;

        // --- ‡∂¥‡∂ª‡∂´ ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂∏‡∑î‡∂Ω‡∑í‡∂±‡∑ä‡∂∏ ‡∂Ω‡∑ù‡∂©‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏ ---
        db.ref('users/' + userId).on('value', (snap) => {
            const data = snap.val();
            if(data) {
                balance = data.balance || 0;
                // ‡∂∏‡∑î‡∂Ω‡∑ä ‡∑Ä‡∂ª‡∂ß ‡∂Ω‡∑ù‡∂©‡∑ä ‡∑Ä‡∑ô‡∂Ø‡∑ä‡∂Ø‡∑ì ‡∂¥‡∂∏‡∂´‡∂ö‡∑ä Display ‡∂ë‡∂ö Update ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
                if(!isLoaded) {
                    updateUI();
                    isLoaded = true;
                }
            } else {
                saveToDB(); // ‡∂Ö‡∂Ω‡∑î‡∂≠‡∑ä ‡∂∫‡∑ñ‡∑É‡∂ª‡∑ä ‡∂ö‡∑ô‡∂±‡∑ô‡∂ö‡∑ä ‡∂±‡∂∏‡∑ä ‡∑É‡∑ö‡∑Ä‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
            }
        });

        function updateUI() {
            document.getElementById('balance').innerText = balance.toLocaleString();
            document.getElementById('energy').innerText = energy;
        }

        function saveToDB() {
            db.ref('users/' + userId).update({
                balance: balance,
                lastUpdate: Date.now()
            });
        }

        // --- TAPPING LOGIC ---
        document.getElementById('tap-btn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            if(energy <= 0) return;

            balance += 1;
            energy -= 1;
            updateUI();
            
            // Animation
            const t = e.touches[0];
            const p = document.createElement('div');
            p.className = 'floating-text'; p.innerText = '+1';
            p.style.left = t.clientX+'px'; p.style.top = t.clientY+'px';
            document.body.appendChild(p);
            setTimeout(() => { p.remove(); saveToDB(); }, 600);
        });

        // --- PAGE NAVIGATION ---
        function showPage(pageId, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }

        // --- WITHDRAWAL REQUEST ---
        function requestWithdraw() {
            const addr = document.getElementById('wallet-addr').value;
            if(balance < 1000000) {
                alert("‡∂Ö‡∑Ä‡∂∏ ‡∂ö‡∑ú‡∂∫‡∑í‡∂±‡∑ä 1,000,000‡∂ö‡∑ä ‡∂≠‡∑í‡∂∂‡∑í‡∂∫ ‡∂∫‡∑î‡∂≠‡∑î‡∂∫!");
                return;
            }
            if(!addr) { alert("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª Phone/Wallet ‡∂Ö‡∂Ç‡∂ö‡∂∫ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±."); return; }

            db.ref('withdrawals').push({
                userId: userId,
                amount: balance,
                address: addr,
                status: 'pending',
                time: Date.now()
            }).then(() => {
                alert("Withdraw Request ‡∂ë‡∂ö ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö‡∑Ä ‡∂∫‡∑ú‡∂∏‡∑î ‡∂ö‡∑Ö‡∑è!");
            });
        }

        // Energy Recovery
        setInterval(() => { if(energy < 1000) { energy += 1; updateUI(); } }, 2000);
    </script>
</body>
</html>
