<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>COCO PREMIUM NETWORK</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #f1c40f; --dark: #0a0a0a; }
        body { background: var(--dark); color: white; text-align: center; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; user-select: none; margin: 0; overflow: hidden; }
        
        /* Top Bar */
        .top-info { display: flex; justify-content: space-between; padding: 20px; font-size: 12px; color: #888; letter-spacing: 1px; }
        
        /* Balance Section */
        #balance-container { margin-top: 20px; }
        #balance { font-size: 55px; font-weight: 800; text-shadow: 0 0 20px rgba(241,196,15,0.5); }
        .currency { font-size: 20px; color: var(--gold); }

        /* Coin Animation */
        .coin-wrapper { position: relative; margin: 40px auto; width: 250px; height: 250px; }
        .coin-btn { 
            width: 100%; height: 100%; border-radius: 50%; 
            background: radial-gradient(circle, #5d4037 0%, #000 100%);
            border: 10px solid #222; position: relative; cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 100px;
            box-shadow: 0 0 50px rgba(0,0,0,1), inset 0 0 20px rgba(241,196,15,0.1);
            transition: transform 0.1s ease;
        }
        .coin-btn:active { transform: scale(0.92); border-color: var(--gold); }
        
        /* Energy Bar */
        .energy-container { width: 80%; height: 12px; background: #222; margin: 20px auto; border-radius: 10px; overflow: hidden; border: 1px solid #333; }
        #energy-fill { width: 100%; height: 100%; background: linear-gradient(90deg, #f1c40f, #e67e22); transition: width 0.2s; }

        /* Floating +1 Effect */
        .floating-text { position: absolute; color: var(--gold); font-size: 24px; font-weight: bold; pointer-events: none; animation: moveUp 0.7s ease-out forwards; z-index: 10; }
        @keyframes moveUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-120px); } }

        /* Navigation */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #111; padding: 15px 0; border-top: 1px solid #222; }
        .nav-tab { flex: 1; color: #555; font-size: 12px; font-weight: bold; }
        .nav-tab.active { color: var(--gold); }

        /* Daily Modal */
        #daily-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1a1a1a; padding: 30px; border-radius: 20px; border: 2px solid var(--gold); z-index: 100; display: none; }
    </style>
</head>
<body>

    <div class="top-info">
        <span>üì∂ COCO SECURE</span>
        <span id="user-display">PLAYER: LOADING...</span>
    </div>

    <div id="balance-container">
        <div id="balance">0</div>
        <div class="currency">COCO COINS</div>
    </div>

    <div class="coin-wrapper">
        <div class="coin-btn" id="tap-btn">ü••</div>
    </div>

    <div style="font-size: 14px; color: #888;">‚ö° ENERGY</div>
    <div class="energy-container">
        <div id="energy-fill"></div>
    </div>

    <div id="daily-modal">
        <h2 style="color:var(--gold)">DAILY BONUS!</h2>
        <p>‡∂î‡∂∂ ‡∂Ö‡∂Ø ‡∂¥‡∑ê‡∂∏‡∑í‡∂´‡∑í ‡∂±‡∑í‡∑É‡∑è ‡∂ö‡∑ú‡∂∫‡∑í‡∂±‡∑ä 500‡∂ö‡∑ä ‡∂Ω‡∑ê‡∂∂‡∑î‡∂´‡∑è!</p>
        <button onclick="closeModal()" style="background:var(--gold); border:none; padding:10px 20px; border-radius:10px; font-weight:bold;">‡∂Ω‡∂∂‡∑è‡∂ú‡∂±‡∑ä‡∂±</button>
    </div>

    <div class="bottom-nav">
        <div class="nav-tab active">‚õèÔ∏è MINE</div>
        <div class="nav-tab">üèÜ FRIENDS</div>
        <div class="nav-tab">üí∞ EARN</div>
    </div>

    <audio id="tap-sound" src="tap-sound.mp3"></audio>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <script>
        // --- CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyDE9SYe-4rS5jMeXStqg9pc_IuBsiySdaU",
            authDomain: "cococoin-mine-c7b27.firebaseapp.com",
            projectId: "cococoin-mine-c7b27",
            databaseURL: "https://cococoin-mine-c7b27-default-rtdb.asia-southeast1.firebasedatabase.app/",
            appId: "1:546963919107:web:acbb4d1eac94686d3f1936"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- USER SYSTEM ---
        const tg = window.Telegram.WebApp;
        let userId, userName;

        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            userId = tg.initDataUnsafe.user.id;
            userName = tg.initDataUnsafe.user.first_name;
        } else {
            // ‡∂ß‡∑ô‡∂Ω‡∑í‡∂ú‡∑ä‚Äç‡∂ª‡∑ë‡∂∏‡∑ä ‡∂±‡∑ê‡∂≠‡∑í‡∂±‡∂∏‡∑ä ‡∂¥‡∑è‡∑Ä‡∑í‡∂†‡∑ä‡∂†‡∑í ‡∑Ä‡∂± ID ‡∂ë‡∂ö
            userId = localStorage.getItem('guest_id') || "guest_" + Math.floor(Math.random()*1000000);
            localStorage.setItem('guest_id', userId);
            userName = "GUEST PLAYER";
        }
        document.getElementById('user-display').innerText = "PLAYER: " + userName.toUpperCase();

        // --- APP STATE ---
        let balance = 0;
        let energy = 1000;
        let lastSyncTime = 0;

        // Load Data from Firebase
        db.ref('users/' + userId).on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                balance = data.balance || 0;
                updateDisplay();
                checkDailyBonus(data.lastLogin);
            } else {
                // New User
                saveToDB();
            }
        });

        function updateDisplay() {
            document.getElementById('balance').innerText = balance.toLocaleString();
            document.getElementById('energy-fill').style.width = (energy / 10) + "%";
        }

        function saveToDB() {
            db.ref('users/' + userId).update({
                balance: balance,
                username: userName,
                lastUpdate: Date.now()
            });
        }

        // --- TAP LOGIC ---
        const tapBtn = document.getElementById('tap-btn');
        const tapSound = document.getElementById('tap-sound');

        tapBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            if (energy <= 0) return;

            // Update State
            balance += 1;
            energy -= 1;
            updateDisplay();

            // Vibration & Sound
            if (navigator.vibrate) navigator.vibrate(20);
            tapSound.currentTime = 0;
            tapSound.play().catch(() => {});

            // Animation
            const touch = e.touches[0];
            createFloatingText(touch.clientX, touch.clientY);

            // Sync with DB every 2 seconds to avoid lag
            if (Date.now() - lastSyncTime > 2000) {
                saveToDB();
                lastSyncTime = Date.now();
            }
        });

        function createFloatingText(x, y) {
            const el = document.createElement('div');
            el.className = 'floating-text';
            el.innerText = "+1";
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 700);
        }

        // --- DAILY BONUS ---
        function checkDailyBonus(lastLogin) {
            const today = new Date().toDateString();
            if (lastLogin !== today) {
                document.getElementById('daily-modal').style.display = 'block';
                db.ref('users/' + userId).update({ lastLogin: today });
            }
        }

        function closeModal() {
            balance += 500;
            saveToDB();
            document.getElementById('daily-modal').style.display = 'none';
        }

        // Energy Recovery
        setInterval(() => {
            if (energy < 1000) {
                energy += 1;
                updateDisplay();
            }
        }, 1500);

    </script>
</body>
</html>
